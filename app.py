import streamlit as st
from google import genai  # ìµœì‹  google-genai ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
import streamlit_analytics2 as streamlit_analytics # 1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
from google.genai import types

# =================================================================
# 1. [ë³´ì•ˆ ë° ì„¤ì •] API í‚¤ ë° ëª¨ë¸ ì„¤ì •
# =================================================================

# ë°°í¬ ì‹œì—ëŠ” Streamlit Secretsë¥¼ ì‚¬ìš©í•˜ê³ , ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” ì§ì ‘ ì…ë ¥ëœ í‚¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
try:
    API_KEY = st.secrets["GEMINI_API_KEY"]
except:
    # ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© (ê¹ƒí—ˆë¸Œ ì—…ë¡œë“œ ì „ ë°˜ë“œì‹œ í™•ì¸!)
    API_KEY = "AIzaSyARc0hXnOWx7XLXDrIgZMI3wN_O8bkG6F4"

# ìµœì‹  SDK ë°©ì‹ì¸ Client ê°ì²´ ìƒì„±
client = genai.Client(api_key=API_KEY)

# ì„±í˜„ë‹˜ì´ ë³´ë‚´ì£¼ì‹  ì´ë¯¸ì§€ ì† ëª¨ë¸ ë¦¬ìŠ¤íŠ¸ (ê°€ì¥ ì„±ëŠ¥ì´ ì¢‹ê³  ë¹ ë¥¸ Lite ëª¨ë¸ ìš°ì„  ê¶Œì¥)
# ëª¨ë¸ ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹œë„í•  ìˆ˜ ìˆë„ë¡ ë¦¬ìŠ¤íŠ¸í™” í–ˆìŠµë‹ˆë‹¤.
MODEL_NAME = "gemini-2.5-flash-lite" 

# =================================================================
# 2. [UI ë ˆì´ì•„ì›ƒ] Streamlit í˜ì´ì§€ êµ¬ì„±
# =================================================================

st.set_page_config(page_title="Value Bridge Demo", page_icon="ğŸŒ‰", layout="centered")

import streamlit as st
import streamlit_analytics2 as streamlit_analytics # 1. ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
from google import genai

# ... (API ì„¤ì • ë¶€ë¶„) ...

# 2. ëª¨ë“  UI ì½”ë“œë¥¼ track()ìœ¼ë¡œ ê°ìŒ‰ë‹ˆë‹¤.
with streamlit_analytics.track():
    # 1. ì œëª© ë° ì„¤ëª… (ì¤‘ë³µ ì œê±°ë¨)
    st.title("ğŸŒ‰ Value Bridge")
    st.markdown("#### **ê²½í—˜ì„ ê¸°ì—…ì˜ ì–¸ì–´ë¡œ, 'ë²¨ë¥˜ ë¸Œë¦¿ì§€'**")
    st.write("ì‚¬ìš©ìì˜ ëŒ€í•™ ìƒí™œê³¼ ìŠ¤í™ì„ ë¶„ì„í•˜ì—¬ ëª©í‘œ ê¸°ì—…ì´ ì„ í˜¸í•˜ëŠ” í•µì‹¬ í‚¤ì›Œë“œë¡œ ë³€í™˜í•´ ë“œë¦½ë‹ˆë‹¤.")

    st.divider() # ì‹œê°ì  êµ¬ë¶„ì„ 

    # 2. ì‚¬ìš©ì ì…ë ¥ì„ ë°›ê¸° ìœ„í•œ í¼(Form) ìƒì„±
    with st.form("value_bridge_form"):
        st.info("ğŸ’¡ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í• ìˆ˜ë¡ ë” ì •í™•í•œ ë¶„ì„ ê²°ê³¼ê°€ ë‚˜ì˜µë‹ˆë‹¤.")
        
        col1, col2 = st.columns(2)
        with col1:
            school = st.text_input("ğŸ“ í•™êµ", placeholder="ì˜ˆ: í•œì–‘ëŒ€í•™êµ ERICA")
            major = st.text_input("ğŸ“š ì „ê³µ", placeholder="ì˜ˆ: ê²½ì œí•™ë¶€")
        with col2:
            target_company = st.text_input("ğŸ¢ ëª©í‘œ ê¸°ì—…", placeholder="ì˜ˆ: í•œêµ­ì€í–‰, ì‹ í•œì€í–‰")
            spec = st.text_input("ğŸ“œ ë³´ìœ  ìê²©ì¦/ì–´í•™", placeholder="ì˜ˆ: AFPK, ADsP, í† ìµ 900")

        # ì£¼ìš” ê²½í—˜ ì…ë ¥ì°½
        experience = st.text_area("ğŸŒŸ ì£¼ìš” ê²½í—˜ ë° í™œë™", 
                                  placeholder="ì˜ˆ: ë…¸ë™ê²½ì œí•™ ìˆ˜ì—… ì¤‘ íŒŒì´ì¬ì„ í™œìš©í•œ ë°ì´í„° ë¶„ì„ í”„ë¡œì íŠ¸ ìˆ˜í–‰",
                                  help="ìì†Œì„œì— ì“°ê³  ì‹¶ì€ ê°€ì¥ í•µì‹¬ì ì¸ ê²½í—˜ì„ ì ì–´ì£¼ì„¸ìš”.")

        # 3. í¼ ì œì¶œ ë²„íŠ¼ (ì´ì œ ì´ ë²„íŠ¼ì´ ì •ìƒì ìœ¼ë¡œ ì¹´ìš´íŠ¸ë©ë‹ˆë‹¤!)
        submit_button = st.form_submit_button("ğŸ”‘ í•µì‹¬ í‚¤ì›Œë“œ ë¸Œë¦¿ì§€ ìƒì„±", key="generate_button")

    # 4. ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œì§ ì‹¤í–‰ (ì´ ë¶€ë¶„ë„ track ì•ˆì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤)
    if submit_button:
        if not (school and major and target_company and experience):
            st.error("ë¶„ì„ì„ ìœ„í•´ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
        else:
            with st.spinner("AIê°€ ë‹¹ì‹ ì˜ ê°€ì¹˜ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
                # ... (ì—¬ê¸°ì— ì§€ë‚œë²ˆ ì‘ì„±í•œ client.models.generate_content ë¡œì§ì„ ë„£ìœ¼ì„¸ìš”) ...
                st.success("ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!")

# =================================================================
# 3. [ë¡œì§] API í˜¸ì¶œ ë° ê²°ê³¼ ì¶œë ¥
# =================================================================

if submit_button:
    # í•„ìˆ˜ ì…ë ¥ í•­ëª© ì²´í¬
    if not (school and major and target_company and experience):
        st.error("ë¶„ì„ì„ ìœ„í•´ ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.")
    else:
        with st.spinner("ìµœì‹  Gemini ëª¨ë¸ì´ ë‹¹ì‹ ì˜ ê°€ì¹˜ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤..."):
            try:
                # ìµœì‹  SDK ë¬¸ë²•: client.models.generate_content ì‚¬ìš©
                # ì„±í˜„ë‹˜ì˜ ë²¨ë¥˜ ë¸Œë¦¿ì§€ í”„ë¡œì íŠ¸ ëª©ì ì— ë§ì¶˜ ì „ìš© í”„ë¡¬í”„íŠ¸
                prompt_text = f"""
                ë‹¹ì‹ ì€ ëŒ€í•™ìƒì˜ ì—­ëŸ‰ì„ ê¸°ì—…ì˜ í•µì‹¬ê°€ì¹˜ì™€ ì—°ê²°í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
                ì•„ë˜ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ, {target_company} ì§€ì› ì‹œ ê°€ì¥ ê²½ìŸë ¥ ìˆëŠ” [í•µì‹¬ í‚¤ì›Œë“œ] 5ê°œë¥¼ ë„ì¶œí•˜ì„¸ìš”.

                [ì‚¬ìš©ì ì •ë³´]
                - í•™êµ/ì „ê³µ: {school} {major}
                - ë³´ìœ  ìŠ¤í™: {spec}
                - ì£¼ìš” í™œë™: {experience}

                [ìš”êµ¬ì‚¬í•­]
                1. ê²°ê³¼ëŠ” ë°˜ë“œì‹œ [í‚¤ì›Œë“œ1, í‚¤ì›Œë“œ2, í‚¤ì›Œë“œ3, í‚¤ì›Œë“œ4, í‚¤ì›Œë“œ5] í˜•íƒœì˜ ë¦¬ìŠ¤íŠ¸ë¡œ ì‹œì‘í•˜ì„¸ìš”.
                2. ê° í‚¤ì›Œë“œë³„ë¡œ ì´ í‚¤ì›Œë“œê°€ ì™œ ë„ì¶œë˜ì—ˆëŠ”ì§€ ìì†Œì„œ ì‘ì„± íŒì„ í•œ ì¤„ì”© ë§ë¶™ì—¬ì£¼ì„¸ìš”.
                3. {target_company}ì˜ ìµœì‹  ì±„ìš© íŠ¸ë Œë“œì™€ ì§ë¬´ ì—­ëŸ‰ì„ ë°˜ì˜í•˜ì„¸ìš”.
                """

                # API í˜¸ì¶œ ì‹¤í–‰
                response = client.models.generate_content(
                    model=MODEL_NAME,
                    contents=prompt_text
                )

                # ê²°ê³¼ ì¶œë ¥ ì„¹ì…˜
                st.success(f"âœ… {target_company} í•©ê²©ì„ ìœ„í•œ í‚¤ì›Œë“œ ë¸Œë¦¿ì§€ ì™„ì„±!")
                st.markdown("---")
                st.markdown(response.text) # AIê°€ ìƒì„±í•œ í…ìŠ¤íŠ¸ ì¶œë ¥
                
                # 4. [ìˆ˜ìš”ì¡°ì‚¬] ë°ëª¨ í”¼ë“œë°± ë§í¬ (ì„±í˜„ë‹˜ êµ¬ê¸€ í¼ ì£¼ì†Œë¡œ ë³€ê²½ í•„ìš”)
                st.info("âœ¨ ë¶„ì„ ê²°ê³¼ê°€ ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”? ì •ì‹ ë²„ì „ ì¶œì‹œë¥¼ ìœ„í•´ ì˜ê²¬ì„ ë‚¨ê²¨ì£¼ì„¸ìš”!")
                st.link_button("ìˆ˜ìš”ì¡°ì‚¬ ì°¸ì—¬í•˜ê³  ì•Œë¦¼ ë°›ê¸°", "www.naver.com")

            except Exception as e:
                # ì—ëŸ¬ ë°œìƒ ì‹œ ìƒì„¸ ë‚´ìš© ì¶œë ¥ (ë””ë²„ê¹…ìš©)
                st.error(f"ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {str(e)}")

# í•˜ë‹¨ í‘¸í„°
st.caption("Â© 2026 Value Bridge Project. All rights reserved.")